Package galoot;

///////////////////////////////////////////////////////////////////////////////
Helpers
///////////////////////////////////////////////////////////////////////////////

    digit           = ['0' .. '9'];
    alpha           = [['A' .. 'Z'] + ['a' .. 'z']];
    alpha_num       = alpha | digit;
    any_char        = [0x0 .. 0xfffff];
    latin1_char     = [0x0 .. 0xff];
    

///////////////////////////////////////////////////////////////////////////////
States
///////////////////////////////////////////////////////////////////////////////
    base, var;

    
///////////////////////////////////////////////////////////////////////////////
Tokens
///////////////////////////////////////////////////////////////////////////////

    {base}          comment         = '{#' [any_char - '#']* '#'+ ([any_char - ['#' + '}']] [any_char - '#']* '#'+)* '}';
    
    //variable translation tokens
    {base->var}     var_start       = '{{';
    {var->base}     var_end         = '}}';
    {var}           var_expression  = [any_char - '}']* ('}' [any_char - '}'])*;
    
    {base}          text_char       = latin1_char;
    

///////////////////////////////////////////////////////////////////////////////
//Ignored Tokens
///////////////////////////////////////////////////////////////////////////////
    //comment;

///////////////////////////////////////////////////////////////////////////////
Productions
///////////////////////////////////////////////////////////////////////////////

    document = [entities]:entity+;
    
    entity {-> entity} =
            {comment}   [comment]:comment                               {-> New entity.comment(comment)}
        |   {char}      [char]:text_char                                {-> New entity.char(char)}
        |   {variable}  var_start [expression]:var_expression var_end   {-> New entity.variable(expression)};


///////////////////////////////////////////////////////////////////////////////
Abstract Syntax Tree
///////////////////////////////////////////////////////////////////////////////

    document = [entities]:entity+;
    
    entity =
            {comment}   comment
        |   {char}      text_char
        |   {variable}  var_expression;
